<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Column Drag and Drop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .grid-container {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .status {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 14px;
        }
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: #ffffff;
            color: #374151;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        .btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .btn.primary:hover {
            background: #2563eb;
            border-color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Column Drag and Drop Test</h1>
        <div id="status" class="status">Initializing grid with column dragging...</div>
        
        <div class="controls">
            <button class="btn primary" onclick="addColumn()">Add Column</button>
            <button class="btn" onclick="resetColumns()">Reset Columns</button>
            <button class="btn" onclick="toggleDragging()">Toggle Column Dragging</button>
        </div>
        
        <div id="grid-container" class="grid-container"></div>
    </div>

    <script type="module">
        import { Grid } from '/src/components/grid/index.js';

        const statusElement = document.getElementById('status');
        let grid = null;
        let columnDraggingEnabled = true;
        
        function updateStatus(message) {
            const timestamp = new Date().toLocaleTimeString();
            statusElement.textContent = `[${timestamp}] ${message}`;
        }

        // Test data with multiple columns
        const testData = [
            { id: 1, name: 'Alice Johnson', department: 'Engineering', salary: 95000, active: true, startDate: '2021-03-15' },
            { id: 2, name: 'Bob Smith', department: 'Marketing', salary: 72000, active: true, startDate: '2020-08-01' },
            { id: 3, name: 'Carol Davis', department: 'Sales', salary: 68000, active: false, startDate: '2019-11-20' },
            { id: 4, name: 'David Wilson', department: 'Engineering', salary: 87000, active: true, startDate: '2022-01-10' },
            { id: 5, name: 'Eva Brown', department: 'HR', salary: 61000, active: true, startDate: '2020-05-12' }
        ];

        let columns = [
            { key: 'name', label: 'Employee Name', type: 'text', width: '200px' },
            { key: 'department', label: 'Department', type: 'text', width: '150px' },
            { key: 'salary', label: 'Salary', type: 'number', width: '120px', format: (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value) },
            { key: 'active', label: 'Active', type: 'boolean', width: '80px' },
            { key: 'startDate', label: 'Start Date', type: 'text', width: '120px' }
        ];

        function initializeGrid() {
            try {
                updateStatus('Creating grid with column dragging enabled...');
                
                grid = Grid.create({
                    data: testData,
                    columns: columns,
                    mode: 'table',
                    
                    // Enable both row and column dragging
                    rowDragging: {
                        enabled: true,
                        onDrop: (sourceIndex, targetIndex, newData) => {
                            updateStatus(`Row moved: ${sourceIndex + 1} → ${targetIndex + 1}`);
                        }
                    },
                    
                    columnDragging: {
                        enabled: columnDraggingEnabled,
                        onColumnDragStart: (columnKey, columnIndex) => {
                            updateStatus(`Started dragging column: ${columnKey} (index ${columnIndex})`);
                        },
                        onColumnDragOver: (sourceIndex, targetIndex) => {
                            updateStatus(`Column drag over: ${sourceIndex} → ${targetIndex}`);
                        },
                        onColumnDrop: (sourceIndex, targetIndex, newColumns) => {
                            updateStatus(`Column moved: ${sourceIndex} → ${targetIndex}. New order: ${newColumns.map(col => col.key).join(', ')}`);
                            columns = newColumns; // Update our columns array
                        },
                        onColumnOrderChange: (newOrder) => {
                            updateStatus(`Column order changed: ${newOrder.join(', ')}`);
                        }
                    },
                    
                    dom: document.getElementById('grid-container')
                });
                
                updateStatus('✅ Grid initialized! Try dragging column headers to reorder columns.');
                
            } catch (error) {
                updateStatus(`❌ Error: ${error.message}`);
                console.error('Grid initialization failed:', error);
            }
        }

        // Control functions
        window.addColumn = () => {
            const newColumn = {
                key: `custom_${Date.now()}`,
                label: `Custom ${columns.length + 1}`,
                type: 'text',
                width: '100px'
            };
            
            columns.push(newColumn);
            grid.updateColumns(columns);
            updateStatus(`Added column: ${newColumn.label}`);
        };

        window.resetColumns = () => {
            columns = [
                { key: 'name', label: 'Employee Name', type: 'text', width: '200px' },
                { key: 'department', label: 'Department', type: 'text', width: '150px' },
                { key: 'salary', label: 'Salary', type: 'number', width: '120px', format: (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value) },
                { key: 'active', label: 'Active', type: 'boolean', width: '80px' },
                { key: 'startDate', label: 'Start Date', type: 'text', width: '120px' }
            ];
            
            grid.updateColumns(columns);
            updateStatus('Columns reset to original order');
        };

        window.toggleDragging = () => {
            columnDraggingEnabled = !columnDraggingEnabled;
            
            // Reinitialize grid with new dragging setting
            document.getElementById('grid-container').innerHTML = '';
            initializeGrid();
            
            updateStatus(`Column dragging ${columnDraggingEnabled ? 'enabled' : 'disabled'}`);
        };

        // Initialize the grid
        initializeGrid();
    </script>
</body>
</html>